<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Generic File Converter</title>

<style>
*{
margin:0;
padding:0;
box-sizing:border-box;
font-family:Segoe UI, sans-serif;
}

body{
min-height:100vh;
display:flex;
justify-content:center;
align-items:center;
background:linear-gradient(135deg,#667eea,#764ba2);
padding:20px;
}

.card{
background:white;
width:100%;
max-width:700px;
padding:30px;
border-radius:20px;
box-shadow:0 25px 50px rgba(0,0,0,0.2);
text-align:center;
}

h2{margin-bottom:20px;}

.drop-area{
border:2px dashed #764ba2;
padding:25px;
border-radius:15px;
cursor:pointer;
transition:0.3s;
}

.drop-area:hover{background:#f3f0ff;}

.preview{
margin-top:20px;
max-height:250px;
overflow:auto;
}

img,canvas,textarea{
width:100%;
margin-top:10px;
border-radius:12px;
box-shadow:0 5px 15px rgba(0,0,0,0.2);
}

textarea{
height:150px;
padding:10px;
resize:none;
}

select,button{
margin-top:15px;
padding:12px;
width:100%;
border:none;
border-radius:12px;
font-size:16px;
}

select{border:1px solid #ccc;}

button{
background:#764ba2;
color:white;
cursor:pointer;
transition:0.3s;
}

button:hover{
transform:translateY(-2px);
box-shadow:0 10px 20px rgba(0,0,0,0.2);
}

.loader{
display:none;
margin-top:15px;
}

.loader div{
width:25px;
height:25px;
border:4px solid #764ba2;
border-top:4px solid transparent;
border-radius:50%;
animation:spin 1s linear infinite;
margin:auto;
}

@keyframes spin{
100%{transform:rotate(360deg);}
}

@media(max-width:600px){
.card{padding:20px;}
}
</style>
</head>

<body>

<div class="card">
<h2>Generic File Converter</h2>

<div class="drop-area" id="dropArea">
Drag & Drop File Here<br>or Click to Upload
<input type="file" id="fileInput" hidden>
</div>

<div class="preview" id="preview"></div>

<select id="formatSelect">
<option value="">Select Output Format</option>
<option value="png">Convert Image → PNG</option>
<option value="jpg">Convert Image → JPG</option>
<option value="webp">Convert Image → WEBP</option>
<option value="txt">Convert JSON → TXT</option>
<option value="json">Convert TXT → JSON</option>
</select>

<button id="convertBtn">Convert File</button>
<button id="downloadBtn" style="display:none;">Download File</button>

<div class="loader"><div></div></div>

</div>

<script>
const dropArea=document.getElementById("dropArea");
const fileInput=document.getElementById("fileInput");
const preview=document.getElementById("preview");
const convertBtn=document.getElementById("convertBtn");
const downloadBtn=document.getElementById("downloadBtn");
const formatSelect=document.getElementById("formatSelect");
const loader=document.querySelector(".loader");

let selectedFile=null;
let convertedBlob=null;

dropArea.addEventListener("click",()=>fileInput.click());
dropArea.addEventListener("dragover",(e)=>e.preventDefault());
dropArea.addEventListener("drop",(e)=>{
e.preventDefault();
handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener("change",(e)=>{
handleFile(e.target.files[0]);
});

function handleFile(file){
if(!file){
alert("No file selected");
return;
}

selectedFile=file;
preview.innerHTML="";
downloadBtn.style.display="none";

if(file.type.startsWith("image/")){
const img=document.createElement("img");
img.src=URL.createObjectURL(file);
preview.appendChild(img);
}else{
const reader=new FileReader();
reader.onload=function(e){
const textarea=document.createElement("textarea");
textarea.value=e.target.result;
preview.appendChild(textarea);
};
reader.readAsText(file);
}
}

convertBtn.addEventListener("click",()=>{
if(!selectedFile){
alert("Upload file first");
return;
}

if(!formatSelect.value){
alert("Select output format");
return;
}

loader.style.display="block";

setTimeout(()=>{
if(selectedFile.type.startsWith("image/")){
convertImage();
}else{
convertText();
}
loader.style.display="none";
downloadBtn.style.display="block";
},300);
});

function convertImage(){
const img=new Image();
img.src=URL.createObjectURL(selectedFile);
img.onload=function(){
const canvas=document.createElement("canvas");
canvas.width=img.width;
canvas.height=img.height;
const ctx=canvas.getContext("2d");
ctx.drawImage(img,0,0);

let mime="image/png";
if(formatSelect.value==="jpg") mime="image/jpeg";
if(formatSelect.value==="webp") mime="image/webp";

const dataURL=canvas.toDataURL(mime,0.9);
convertedBlob=dataURLToBlob(dataURL);

preview.innerHTML="";
preview.appendChild(canvas);
};
}

function convertText(){
const reader=new FileReader();
reader.onload=function(e){
let result=e.target.result;

if(formatSelect.value==="json"){
try{
const obj={data:result};
result=JSON.stringify(obj,null,2);
}catch{}
}
if(formatSelect.value==="txt"){
try{
const obj=JSON.parse(result);
result=JSON.stringify(obj);
}catch{}
}

convertedBlob=new Blob([result],{type:"text/plain"});
preview.innerHTML="<textarea>"+result+"</textarea>";
};
reader.readAsText(selectedFile);
}

downloadBtn.addEventListener("click",()=>{
if(!convertedBlob) return;

const link=document.createElement("a");
link.href=URL.createObjectURL(convertedBlob);
link.download="converted."+formatSelect.value;
link.click();
});

function dataURLToBlob(dataURL){
const arr=dataURL.split(',');
const mime=arr[0].match(/:(.*?);/)[1];
const bstr=atob(arr[1]);
let n=bstr.length;
const u8arr=new Uint8Array(n);
while(n--){
u8arr[n]=bstr.charCodeAt(n);
}
return new Blob([u8arr],{type:mime});
}
</script>

</body>
</html>
