<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video to GIF Converter</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&amp;family=Outfit:wght@300;400;500;600&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Outfit', sans-serif; }
    .title-font { font-family: 'Space Grotesk', sans-serif; }
    
    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    
    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 1; }
      100% { transform: scale(1.4); opacity: 0; }
    }
    
    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .gradient-bg {
      background: linear-gradient(-45deg, #0f0f23, #1a1a3e, #2d1b4e, #1e3a5f);
      background-size: 400% 400%;
      animation: gradient-shift 15s ease infinite;
    }
    
    .float-animation { animation: float 6s ease-in-out infinite; }
    .float-delay-1 { animation-delay: -2s; }
    .float-delay-2 { animation-delay: -4s; }
    
    .upload-zone {
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));
      border: 2px dashed rgba(139, 92, 246, 0.5);
      transition: all 0.3s ease;
    }
    
    .upload-zone:hover, .upload-zone.dragover {
      border-color: #8b5cf6;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.2));
      transform: scale(1.02);
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .convert-btn {
      background: linear-gradient(135deg, #8b5cf6, #6366f1, #3b82f6);
      background-size: 200% 200%;
      transition: all 0.3s ease;
    }
    
    .convert-btn:hover:not(:disabled) {
      background-position: 100% 0;
      transform: translateY(-2px);
      box-shadow: 0 20px 40px -10px rgba(139, 92, 246, 0.5);
    }
    
    .convert-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .slider-track {
      background: linear-gradient(90deg, #8b5cf6, #3b82f6);
    }
    
    input[type="range"] {
      -webkit-appearance: none;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      height: 8px;
    }
    
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, #8b5cf6, #3b82f6);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.5);
      transition: transform 0.2s ease;
    }
    
    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.2);
    }
    
    .progress-bar {
      background: linear-gradient(90deg, #8b5cf6, #6366f1, #3b82f6, #8b5cf6);
      background-size: 200% 100%;
      animation: shimmer 2s linear infinite;
    }
    
    .feature-card {
      transition: all 0.3s ease;
    }
    
    .feature-card:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.08);
    }
    
    .orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.3;
    }
    
    .timeline-handle {
      cursor: ew-resize;
      transition: transform 0.2s ease;
    }
    
    .timeline-handle:hover {
      transform: scaleX(1.5);
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full gradient-bg text-white overflow-auto"><!-- Floating Orbs Background -->
  <div class="orb w-96 h-96 bg-purple-500 top-0 left-0 float-animation" style="position: fixed;"></div>
  <div class="orb w-80 h-80 bg-blue-500 bottom-0 right-0 float-animation float-delay-1" style="position: fixed;"></div>
  <div class="orb w-64 h-64 bg-indigo-500 top-1/2 left-1/2 float-animation float-delay-2" style="position: fixed;"></div>
  <div class="relative z-10 min-h-full w-full"><!-- Header -->
   <header class="pt-8 pb-6 px-6 text-center">
    <div class="inline-flex items-center gap-3 mb-4">
     <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center shadow-lg shadow-purple-500/30">
      <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
     </div>
     <h1 id="main-title" class="title-font text-3xl md:text-4xl font-bold bg-gradient-to-r from-white via-purple-200 to-blue-200 bg-clip-text text-transparent">Video to GIF</h1>
    </div>
    <p id="subtitle" class="text-gray-400 text-lg max-w-xl mx-auto">Transform your videos into smooth, share-worthy animated GIFs in seconds</p>
   </header><!-- Main Content -->
   <main class="px-4 md:px-8 pb-12 max-w-6xl mx-auto"><!-- Upload Section -->
    <div id="upload-section" class="mb-8"><label for="video-input" class="upload-zone glass-card rounded-3xl p-12 flex flex-col items-center justify-center cursor-pointer block">
      <div class="w-20 h-20 rounded-full bg-gradient-to-br from-purple-500/20 to-blue-500/20 flex items-center justify-center mb-6 relative">
       <div class="absolute inset-0 rounded-full bg-purple-500/20 animate-ping"></div>
       <svg class="w-10 h-10 text-purple-400 relative z-10" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
       </svg>
      </div><h3 class="title-font text-xl font-semibold mb-2">Drop your video here</h3><p class="text-gray-400 mb-4">or click to browse</p><span class="text-sm text-gray-500">Supports MP4, WebM, MOV â€¢ Max 100MB</span> </label> <input type="file" id="video-input" accept="video/*" class="hidden">
    </div><!-- Editor Section (Hidden by default) -->
    <div id="editor-section" class="hidden"><!-- Video Preview -->
     <div class="glass-card rounded-3xl p-6 mb-6">
      <div class="aspect-video bg-black/50 rounded-2xl overflow-hidden mb-6 relative">
       <video id="video-preview" class="w-full h-full object-contain" playsinline></video>
       <div id="play-overlay" class="absolute inset-0 flex items-center justify-center cursor-pointer bg-black/30 hover:bg-black/20 transition-colors">
        <div class="w-16 h-16 rounded-full bg-white/20 backdrop-blur flex items-center justify-center">
         <svg id="play-icon" class="w-8 h-8 text-white ml-1" fill="currentColor" viewbox="0 0 24 24"><path d="M8 5v14l11-7z" />
         </svg>
        </div>
       </div>
      </div><!-- Timeline -->
      <div class="mb-6"><label class="block text-sm font-medium text-gray-300 mb-3"> <span class="flex items-center gap-2">
         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
         </svg> Trim Clip </span> </label>
       <div class="relative h-16 bg-white/5 rounded-xl overflow-hidden">
        <div id="timeline-track" class="absolute inset-y-0 bg-gradient-to-r from-purple-500/30 to-blue-500/30 rounded-lg" style="left: 0%; right: 0%;"></div>
        <div id="timeline-frames" class="absolute inset-0 flex"></div>
        <div id="start-handle" class="timeline-handle absolute top-0 bottom-0 w-3 bg-purple-500 rounded-l-lg cursor-ew-resize z-10" style="left: 0%;"></div>
        <div id="end-handle" class="timeline-handle absolute top-0 bottom-0 w-3 bg-blue-500 rounded-r-lg cursor-ew-resize z-10" style="right: 0%;"></div>
        <div id="playhead" class="absolute top-0 bottom-0 w-0.5 bg-white z-20" style="left: 0%;"></div>
       </div>
       <div class="flex justify-between mt-2 text-sm text-gray-400"><span id="start-time">0:00</span> <span id="duration-display">Duration: 0:00</span> <span id="end-time">0:00</span>
       </div>
      </div><!-- Settings Grid -->
      <div class="grid md:grid-cols-2 gap-6"><!-- Speed Control -->
       <div><label class="block text-sm font-medium text-gray-300 mb-3"> <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg> Speed: <span id="speed-value">1x</span> </span> </label> <input type="range" id="speed-slider" min="0.25" max="3" step="0.25" value="1" class="w-full">
        <div class="flex justify-between text-xs text-gray-500 mt-1"><span>0.25x</span> <span>3x</span>
        </div>
       </div><!-- FPS Control -->
       <div><label class="block text-sm font-medium text-gray-300 mb-3"> <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg> Frame Rate: <span id="fps-value">15 FPS</span> </span> </label> <input type="range" id="fps-slider" min="5" max="30" step="5" value="15" class="w-full">
        <div class="flex justify-between text-xs text-gray-500 mt-1"><span>5 FPS</span> <span>30 FPS</span>
        </div>
       </div><!-- Quality Control -->
       <div><label class="block text-sm font-medium text-gray-300 mb-3"> <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
          </svg> Quality: <span id="quality-value">Medium</span> </span> </label> <input type="range" id="quality-slider" min="1" max="3" step="1" value="2" class="w-full">
        <div class="flex justify-between text-xs text-gray-500 mt-1"><span>Low</span> <span>High</span>
        </div>
       </div><!-- Size Control -->
       <div><label class="block text-sm font-medium text-gray-300 mb-3"> <span class="flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
          </svg> Max Width: <span id="size-value">480px</span> </span> </label> <input type="range" id="size-slider" min="240" max="720" step="120" value="480" class="w-full">
        <div class="flex justify-between text-xs text-gray-500 mt-1"><span>240px</span> <span>720px</span>
        </div>
       </div>
      </div>
     </div><!-- Estimated Size & Convert Button -->
     <div class="glass-card rounded-3xl p-6 mb-6">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
       <div class="text-center md:text-left">
        <p class="text-gray-400 text-sm">Estimated file size</p>
        <p id="estimated-size" class="text-2xl font-bold title-font bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">~2.5 MB</p>
       </div><button id="convert-btn" class="convert-btn px-8 py-4 rounded-2xl font-semibold text-lg shadow-lg flex items-center gap-3">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14" />
        </svg><span id="convert-btn-text">Convert to GIF</span> </button>
      </div><!-- Progress Bar (Hidden by default) -->
      <div id="progress-container" class="hidden mt-6">
       <div class="flex justify-between text-sm mb-2"><span id="progress-status" class="text-gray-300">Processing frames...</span> <span id="progress-percent" class="text-purple-400 font-medium">0%</span>
       </div>
       <div class="h-3 bg-white/10 rounded-full overflow-hidden">
        <div id="progress-bar" class="progress-bar h-full rounded-full transition-all duration-300" style="width: 0%;"></div>
       </div>
      </div>
     </div><!-- Back Button --> <button id="back-btn" class="text-gray-400 hover:text-white transition-colors flex items-center gap-2 mx-auto">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
      </svg> Choose different video </button>
    </div><!-- Result Section (Hidden by default) -->
    <div id="result-section" class="hidden">
     <div class="glass-card rounded-3xl p-8 text-center">
      <div class="w-16 h-16 rounded-full bg-gradient-to-br from-green-400 to-emerald-500 flex items-center justify-center mx-auto mb-6">
       <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
       </svg>
      </div>
      <h2 class="title-font text-2xl font-bold mb-2">GIF Created!</h2>
      <p class="text-gray-400 mb-6">Your animated GIF is ready to download and share</p>
      <div class="max-w-lg mx-auto mb-8 rounded-2xl overflow-hidden bg-black/50"><img id="gif-preview" class="w-full" alt="Generated GIF preview">
      </div>
      <div class="flex flex-col sm:flex-row gap-4 justify-center"><a id="download-btn" download="animation.gif" class="convert-btn px-6 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 text-white no-underline">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
        </svg> Download GIF </a> <button id="create-another-btn" class="px-6 py-3 rounded-xl font-semibold border border-white/20 hover:bg-white/10 transition-colors flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
        </svg> Create Another </button>
      </div>
     </div>
    </div><!-- Features Section -->
    <div id="features-section" class="mt-12 grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
     <div class="feature-card glass-card rounded-2xl p-5 text-center">
      <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center mx-auto mb-3">
       <svg class="w-6 h-6 text-purple-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
       </svg>
      </div>
      <h4 class="font-semibold mb-1">Fast Conversion</h4>
      <p class="text-sm text-gray-400">Convert in seconds</p>
     </div>
     <div class="feature-card glass-card rounded-2xl p-5 text-center">
      <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center mx-auto mb-3">
       <svg class="w-6 h-6 text-blue-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
       </svg>
      </div>
      <h4 class="font-semibold mb-1">Crisp Quality</h4>
      <p class="text-sm text-gray-400">HD visuals preserved</p>
     </div>
     <div class="feature-card glass-card rounded-2xl p-5 text-center">
      <div class="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center mx-auto mb-3">
       <svg class="w-6 h-6 text-indigo-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
       </svg>
      </div>
      <h4 class="font-semibold mb-1">Full Control</h4>
      <p class="text-sm text-gray-400">Trim, speed, size</p>
     </div>
     <div class="feature-card glass-card rounded-2xl p-5 text-center">
      <div class="w-12 h-12 rounded-xl bg-pink-500/20 flex items-center justify-center mx-auto mb-3">
       <svg class="w-6 h-6 text-pink-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
       </svg>
      </div>
      <h4 class="font-semibold mb-1">Share Anywhere</h4>
      <p class="text-sm text-gray-400">Lightweight files</p>
     </div>
    </div>
   </main>
  </div><!-- GIF.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
  <script>
    // Default configuration
    const defaultConfig = {
      main_title: 'Video to GIF',
      subtitle_text: 'Transform your videos into smooth, share-worthy animated GIFs in seconds',
      convert_button_text: 'Convert to GIF',
      background_color: '#0f0f23',
      surface_color: 'rgba(255, 255, 255, 0.05)',
      text_color: '#ffffff',
      primary_action_color: '#8b5cf6',
      secondary_action_color: '#3b82f6',
      font_family: 'Outfit',
      font_size: 16
    };

    // State variables
    let videoFile = null;
    let videoDuration = 0;
    let startTime = 0;
    let endTime = 0;
    let isPlaying = false;
    let animationFrame = null;
    let isDragging = null;

    // DOM Elements
    const uploadSection = document.getElementById('upload-section');
    const editorSection = document.getElementById('editor-section');
    const resultSection = document.getElementById('result-section');
    const featuresSection = document.getElementById('features-section');
    const videoInput = document.getElementById('video-input');
    const videoPreview = document.getElementById('video-preview');
    const playOverlay = document.getElementById('play-overlay');
    const playIcon = document.getElementById('play-icon');
    const startHandle = document.getElementById('start-handle');
    const endHandle = document.getElementById('end-handle');
    const timelineTrack = document.getElementById('timeline-track');
    const playhead = document.getElementById('playhead');
    const startTimeEl = document.getElementById('start-time');
    const endTimeEl = document.getElementById('end-time');
    const durationDisplay = document.getElementById('duration-display');
    const speedSlider = document.getElementById('speed-slider');
    const speedValue = document.getElementById('speed-value');
    const fpsSlider = document.getElementById('fps-slider');
    const fpsValue = document.getElementById('fps-value');
    const qualitySlider = document.getElementById('quality-slider');
    const qualityValue = document.getElementById('quality-value');
    const sizeSlider = document.getElementById('size-slider');
    const sizeValue = document.getElementById('size-value');
    const estimatedSize = document.getElementById('estimated-size');
    const convertBtn = document.getElementById('convert-btn');
    const backBtn = document.getElementById('back-btn');
    const progressContainer = document.getElementById('progress-container');
    const progressBar = document.getElementById('progress-bar');
    const progressStatus = document.getElementById('progress-status');
    const progressPercent = document.getElementById('progress-percent');
    const gifPreview = document.getElementById('gif-preview');
    const downloadBtn = document.getElementById('download-btn');
    const createAnotherBtn = document.getElementById('create-another-btn');

    // Format time as M:SS
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // Update timeline display
    function updateTimeline() {
      const startPercent = (startTime / videoDuration) * 100;
      const endPercent = (endTime / videoDuration) * 100;
      
      startHandle.style.left = `${startPercent}%`;
      endHandle.style.right = `${100 - endPercent}%`;
      timelineTrack.style.left = `${startPercent}%`;
      timelineTrack.style.right = `${100 - endPercent}%`;
      
      startTimeEl.textContent = formatTime(startTime);
      endTimeEl.textContent = formatTime(endTime);
      durationDisplay.textContent = `Duration: ${formatTime(endTime - startTime)}`;
      
      updateEstimatedSize();
    }

    // Update playhead position
    function updatePlayhead() {
      if (videoPreview.duration) {
        const percent = (videoPreview.currentTime / videoDuration) * 100;
        playhead.style.left = `${percent}%`;
      }
      if (isPlaying) {
        animationFrame = requestAnimationFrame(updatePlayhead);
      }
    }

    // Calculate estimated file size
    function updateEstimatedSize() {
      const duration = endTime - startTime;
      const fps = parseInt(fpsSlider.value);
      const quality = parseInt(qualitySlider.value);
      const width = parseInt(sizeSlider.value);
      
      // Rough estimation based on parameters
      const frames = duration * fps;
      const qualityMultiplier = quality === 1 ? 0.3 : quality === 2 ? 0.6 : 1;
      const sizeMultiplier = width / 480;
      const baseSize = 0.05; // MB per frame at base settings
      
      const estimated = frames * baseSize * qualityMultiplier * sizeMultiplier * sizeMultiplier;
      estimatedSize.textContent = `~${estimated.toFixed(1)} MB`;
    }

    // Handle video file selection
    function handleVideoSelect(file) {
      if (!file || !file.type.startsWith('video/')) {
        showToast('Please select a valid video file', 'error');
        return;
      }
      
      if (file.size > 100 * 1024 * 1024) {
        showToast('File size must be under 100MB', 'error');
        return;
      }
      
      videoFile = file;
      const url = URL.createObjectURL(file);
      videoPreview.src = url;
      
      videoPreview.onloadedmetadata = () => {
        videoDuration = videoPreview.duration;
        startTime = 0;
        endTime = Math.min(videoDuration, 10); // Default to max 10 seconds
        
        updateTimeline();
        
        uploadSection.classList.add('hidden');
        editorSection.classList.remove('hidden');
        featuresSection.classList.add('hidden');
      };
    }

    // Toast notification
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-xl shadow-lg z-50 ${
        type === 'error' ? 'bg-red-500' : 'bg-purple-500'
      } text-white font-medium`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Video input change
    videoInput.addEventListener('change', (e) => {
      if (e.target.files[0]) {
        handleVideoSelect(e.target.files[0]);
      }
    });

    // Drag and drop
    const uploadZone = document.querySelector('.upload-zone');
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('dragover');
    });
    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('dragover');
    });
    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('dragover');
      if (e.dataTransfer.files[0]) {
        handleVideoSelect(e.dataTransfer.files[0]);
      }
    });

    // Play/pause video
    playOverlay.addEventListener('click', () => {
      if (videoPreview.paused) {
        videoPreview.currentTime = startTime;
        videoPreview.play();
        isPlaying = true;
        playIcon.innerHTML = '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>';
        updatePlayhead();
      } else {
        videoPreview.pause();
        isPlaying = false;
        playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
        cancelAnimationFrame(animationFrame);
      }
    });

    videoPreview.addEventListener('timeupdate', () => {
      if (videoPreview.currentTime >= endTime) {
        videoPreview.pause();
        videoPreview.currentTime = startTime;
        isPlaying = false;
        playIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
      }
    });

    // Timeline dragging
    function handleTimelineDrag(e, handle) {
      const timeline = document.getElementById('timeline-track').parentElement;
      const rect = timeline.getBoundingClientRect();
      const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
      const time = percent * videoDuration;
      
      if (handle === 'start') {
        startTime = Math.max(0, Math.min(time, endTime - 0.5));
      } else {
        endTime = Math.max(startTime + 0.5, Math.min(time, videoDuration));
      }
      
      updateTimeline();
      videoPreview.currentTime = handle === 'start' ? startTime : endTime;
    }

    startHandle.addEventListener('mousedown', (e) => {
      e.preventDefault();
      isDragging = 'start';
    });

    endHandle.addEventListener('mousedown', (e) => {
      e.preventDefault();
      isDragging = 'end';
    });

    document.addEventListener('mousemove', (e) => {
      if (isDragging) {
        handleTimelineDrag(e, isDragging);
      }
    });

    document.addEventListener('mouseup', () => {
      isDragging = null;
    });

    // Sliders
    speedSlider.addEventListener('input', () => {
      const speed = parseFloat(speedSlider.value);
      speedValue.textContent = `${speed}x`;
      videoPreview.playbackRate = speed;
      updateEstimatedSize();
    });

    fpsSlider.addEventListener('input', () => {
      fpsValue.textContent = `${fpsSlider.value} FPS`;
      updateEstimatedSize();
    });

    qualitySlider.addEventListener('input', () => {
      const qualities = ['Low', 'Medium', 'High'];
      qualityValue.textContent = qualities[parseInt(qualitySlider.value) - 1];
      updateEstimatedSize();
    });

    sizeSlider.addEventListener('input', () => {
      sizeValue.textContent = `${sizeSlider.value}px`;
      updateEstimatedSize();
    });

    // Convert to GIF
    convertBtn.addEventListener('click', async () => {
      convertBtn.disabled = true;
      progressContainer.classList.remove('hidden');
      progressBar.style.width = '0%';
      progressPercent.textContent = '0%';
      progressStatus.textContent = 'Preparing conversion...';

      const fps = parseInt(fpsSlider.value);
      const quality = parseInt(qualitySlider.value);
      const maxWidth = parseInt(sizeSlider.value);
      const speed = parseFloat(speedSlider.value);
      const qualityMap = { 1: 20, 2: 10, 3: 1 };

      // Calculate dimensions maintaining aspect ratio
      const aspectRatio = videoPreview.videoWidth / videoPreview.videoHeight;
      const width = maxWidth;
      const height = Math.round(maxWidth / aspectRatio);

      // Create canvas for frame extraction
      const canvas = document.createElement('canvas');
      canvas.width = width;
      canvas.height = height;
      const ctx = canvas.getContext('2d');

      // Initialize GIF encoder
      const gif = new GIF({
        workers: 2,
        quality: qualityMap[quality],
        width: width,
        height: height,
        workerScript: 'https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js'
      });

      // Extract frames
      const duration = endTime - startTime;
      const frameCount = Math.floor(duration * fps / speed);
      const frameInterval = duration / frameCount;
      let framesAdded = 0;

      progressStatus.textContent = 'Extracting frames...';

      const extractFrame = (time) => {
        return new Promise((resolve) => {
          videoPreview.currentTime = time;
          videoPreview.onseeked = () => {
            ctx.drawImage(videoPreview, 0, 0, width, height);
            gif.addFrame(ctx, { copy: true, delay: (1000 / fps) * speed });
            framesAdded++;
            const progress = Math.round((framesAdded / frameCount) * 50);
            progressBar.style.width = `${progress}%`;
            progressPercent.textContent = `${progress}%`;
            resolve();
          };
        });
      };

      // Extract all frames sequentially
      for (let i = 0; i < frameCount; i++) {
        const time = startTime + (i * frameInterval);
        await extractFrame(time);
      }

      progressStatus.textContent = 'Encoding GIF...';

      gif.on('progress', (p) => {
        const progress = 50 + Math.round(p * 50);
        progressBar.style.width = `${progress}%`;
        progressPercent.textContent = `${progress}%`;
      });

      gif.on('finished', (blob) => {
        progressBar.style.width = '100%';
        progressPercent.textContent = '100%';
        progressStatus.textContent = 'Complete!';

        const url = URL.createObjectURL(blob);
        gifPreview.src = url;
        downloadBtn.href = url;

        setTimeout(() => {
          editorSection.classList.add('hidden');
          resultSection.classList.remove('hidden');
          convertBtn.disabled = false;
          progressContainer.classList.add('hidden');
        }, 500);
      });

      gif.render();
    });

    // Back button
    backBtn.addEventListener('click', () => {
      editorSection.classList.add('hidden');
      uploadSection.classList.remove('hidden');
      featuresSection.classList.remove('hidden');
      videoPreview.src = '';
      videoFile = null;
    });

    // Create another
    createAnotherBtn.addEventListener('click', () => {
      resultSection.classList.add('hidden');
      uploadSection.classList.remove('hidden');
      featuresSection.classList.remove('hidden');
      videoPreview.src = '';
      videoFile = null;
    });

    // Element SDK Integration
    async function onConfigChange(config) {
      const c = { ...defaultConfig, ...config };
      
      // Update text content
      document.getElementById('main-title').textContent = c.main_title;
      document.getElementById('subtitle').textContent = c.subtitle_text;
      document.getElementById('convert-btn-text').textContent = c.convert_button_text;
      
      // Update fonts
      const fontStack = `${c.font_family}, Outfit, sans-serif`;
      document.body.style.fontFamily = fontStack;
      
      document.querySelectorAll('.title-font').forEach(el => {
        el.style.fontFamily = `${c.font_family}, Space Grotesk, sans-serif`;
      });
      
      // Update font sizes
      const baseSize = c.font_size;
      document.getElementById('main-title').style.fontSize = `${baseSize * 2}px`;
      document.getElementById('subtitle').style.fontSize = `${baseSize * 1.125}px`;
    }

    function mapToCapabilities(config) {
      const c = { ...defaultConfig, ...config };
      return {
        recolorables: [
          {
            get: () => c.background_color,
            set: (v) => { c.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
          },
          {
            get: () => c.surface_color,
            set: (v) => { c.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
          },
          {
            get: () => c.text_color,
            set: (v) => { c.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
          },
          {
            get: () => c.primary_action_color,
            set: (v) => { c.primary_action_color = v; window.elementSdk.setConfig({ primary_action_color: v }); }
          },
          {
            get: () => c.secondary_action_color,
            set: (v) => { c.secondary_action_color = v; window.elementSdk.setConfig({ secondary_action_color: v }); }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => c.font_family,
          set: (v) => { c.font_family = v; window.elementSdk.setConfig({ font_family: v }); }
        },
        fontSizeable: {
          get: () => c.font_size,
          set: (v) => { c.font_size = v; window.elementSdk.setConfig({ font_size: v }); }
        }
      };
    }

    function mapToEditPanelValues(config) {
      const c = { ...defaultConfig, ...config };
      return new Map([
        ['main_title', c.main_title],
        ['subtitle_text', c.subtitle_text],
        ['convert_button_text', c.convert_button_text]
      ]);
    }

    // Initialize SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d201e0ef7b79083',t:'MTc3MTc4MDQ0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
