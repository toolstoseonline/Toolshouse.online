<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Compressor</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Space Grotesk', sans-serif; }
    .mono { font-family: 'JetBrains Mono', monospace; }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.3); }
      50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.6); }
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes progress-shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    
    .upload-zone {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(168, 85, 247, 0.1) 100%);
      border: 2px dashed rgba(99, 102, 241, 0.4);
      transition: all 0.3s ease;
    }
    
    .upload-zone:hover, .upload-zone.drag-over {
      border-color: rgba(99, 102, 241, 0.8);
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.2) 0%, rgba(168, 85, 247, 0.2) 100%);
      animation: pulse-glow 2s ease-in-out infinite;
    }
    
    .floating-icon { animation: float 3s ease-in-out infinite; }
    
    .progress-bar {
      background: linear-gradient(90deg, #6366f1, #a855f7, #6366f1);
      background-size: 200% 100%;
      animation: progress-shimmer 2s linear infinite;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .quality-btn.active {
      background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
      color: white;
      transform: scale(1.05);
    }
    
    .quality-btn {
      transition: all 0.2s ease;
    }
    
    .quality-btn:hover:not(.active) {
      background: rgba(99, 102, 241, 0.1);
    }
    
    .bg-gradient {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
    }
    
    .stat-card {
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.1) 0%, rgba(168, 85, 247, 0.05) 100%);
    }
  </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gradient overflow-auto">
  <div id="app" class="min-h-full w-full p-6 md:p-8"><!-- Header -->
   <header class="text-center mb-8">
    <div class="inline-flex items-center gap-3 mb-4">
     <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center floating-icon">
      <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
      </svg>
     </div>
     <h1 id="app-title" class="text-3xl md:text-4xl font-bold text-white">Video Compressor</h1>
    </div>
    <p id="subtitle" class="text-gray-400 text-lg">Reduce file size without losing quality</p>
   </header><!-- Main Content -->
   <div class="max-w-2xl mx-auto"><!-- Upload Zone -->
    <div id="upload-section" class="mb-6">
     <div id="upload-zone" class="upload-zone rounded-3xl p-8 md:p-12 text-center cursor-pointer transition-all"><input type="file" id="video-input" accept="video/*" class="hidden">
      <div class="floating-icon mb-6">
       <div class="w-20 h-20 mx-auto rounded-full bg-gradient-to-br from-indigo-500/20 to-purple-600/20 flex items-center justify-center">
        <svg class="w-10 h-10 text-indigo-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
        </svg>
       </div>
      </div>
      <h3 id="upload-btn-text" class="text-xl font-semibold text-white mb-2">Choose Video</h3>
      <p class="text-gray-400 text-sm">or drag and drop your video file here</p>
      <p class="text-gray-500 text-xs mt-3">Supports MP4, WebM, MOV, AVI â€¢ Max 500MB</p>
     </div>
    </div><!-- Video Preview & Settings (Hidden by default) -->
    <div id="settings-section" class="hidden">
     <div class="glass-card rounded-3xl p-6 mb-6"><!-- Video Info -->
      <div class="flex items-center gap-4 mb-6 pb-6 border-b border-gray-200">
       <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center flex-shrink-0">
        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
       </div>
       <div class="flex-1 min-w-0">
        <h4 id="file-name" class="font-semibold text-gray-800 truncate">video.mp4</h4>
        <p id="file-details" class="text-sm text-gray-500 mono">0 MB â€¢ 0:00</p>
       </div><button id="remove-btn" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg></button>
      </div><!-- Quality Selection -->
      <div class="mb-6"><label class="block text-sm font-medium text-gray-700 mb-3">Compression Quality</label>
       <div class="grid grid-cols-3 gap-3"><button class="quality-btn active rounded-xl p-4 border-2 border-transparent" data-quality="high">
         <div class="text-2xl mb-1">
          âœ¨
         </div>
         <div class="font-semibold text-sm">
          High
         </div>
         <div class="text-xs opacity-70">
          Best quality
         </div></button> <button class="quality-btn rounded-xl p-4 border-2 border-gray-200" data-quality="medium">
         <div class="text-2xl mb-1">
          âš¡
         </div>
         <div class="font-semibold text-sm">
          Medium
         </div>
         <div class="text-xs opacity-70">
          Balanced
         </div></button> <button class="quality-btn rounded-xl p-4 border-2 border-gray-200" data-quality="low">
         <div class="text-2xl mb-1">
          ðŸš€
         </div>
         <div class="font-semibold text-sm">
          Maximum
         </div>
         <div class="text-xs opacity-70">
          Smallest size
         </div></button>
       </div>
      </div><!-- Estimated Results -->
      <div class="stat-card rounded-2xl p-4 mb-6">
       <div class="flex items-center justify-between">
        <div>
         <p class="text-xs text-gray-500 uppercase tracking-wide">Estimated Size</p>
         <p id="estimated-size" class="text-2xl font-bold text-indigo-600 mono">~0 MB</p>
        </div>
        <div class="text-right">
         <p class="text-xs text-gray-500 uppercase tracking-wide">Reduction</p>
         <p id="reduction-percent" class="text-2xl font-bold text-green-500 mono">~50%</p>
        </div>
       </div>
      </div><!-- Compress Button --> <button id="compress-btn" class="w-full py-4 px-6 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white font-semibold rounded-2xl transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
       </svg> Compress Video </button>
     </div>
    </div><!-- Progress Section (Hidden by default) -->
    <div id="progress-section" class="hidden">
     <div class="glass-card rounded-3xl p-6 text-center">
      <div class="w-20 h-20 mx-auto mb-6 rounded-full bg-gradient-to-br from-indigo-500/20 to-purple-600/20 flex items-center justify-center">
       <svg class="w-10 h-10 text-indigo-500 animate-spin" fill="none" viewbox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle> <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
       </svg>
      </div>
      <h3 class="text-xl font-semibold text-gray-800 mb-2">Compressing Video</h3>
      <p id="progress-status" class="text-gray-500 mb-6">Processing your video...</p>
      <div class="h-3 bg-gray-200 rounded-full overflow-hidden mb-3">
       <div id="progress-bar" class="progress-bar h-full rounded-full transition-all duration-300" style="width: 0%"></div>
      </div>
      <p id="progress-percent" class="text-sm text-gray-500 mono">0%</p>
     </div>
    </div><!-- Result Section (Hidden by default) -->
    <div id="result-section" class="hidden">
     <div class="glass-card rounded-3xl p-6">
      <div class="text-center mb-6">
       <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-green-100 flex items-center justify-center">
        <svg class="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
       </div>
       <h3 class="text-xl font-semibold text-gray-800 mb-1">Compression Complete!</h3>
       <p class="text-gray-500">Your video has been optimized</p>
      </div><!-- Stats -->
      <div class="grid grid-cols-2 gap-4 mb-6">
       <div class="stat-card rounded-2xl p-4 text-center">
        <p class="text-xs text-gray-500 uppercase tracking-wide mb-1">Original</p>
        <p id="original-size" class="text-xl font-bold text-gray-700 mono">0 MB</p>
       </div>
       <div class="stat-card rounded-2xl p-4 text-center">
        <p class="text-xs text-gray-500 uppercase tracking-wide mb-1">Compressed</p>
        <p id="compressed-size" class="text-xl font-bold text-indigo-600 mono">0 MB</p>
       </div>
      </div>
      <div class="bg-green-50 rounded-2xl p-4 mb-6 text-center">
       <p class="text-green-700 font-semibold"><span id="saved-size">0 MB</span> saved <span class="text-green-500">(<span id="saved-percent">0</span>% smaller)</span></p>
      </div><!-- Download Button --> <button id="download-btn" class="w-full py-4 px-6 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-semibold rounded-2xl transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-2 mb-3">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
       </svg> Download Compressed Video </button> <button id="new-video-btn" class="w-full py-3 px-6 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-2xl transition-all"> Compress Another Video </button>
     </div>
    </div><!-- Features -->
    <div class="mt-8 grid grid-cols-3 gap-4 text-center">
     <div class="p-4">
      <div class="text-2xl mb-2">
       ðŸ”’
      </div>
      <p class="text-xs text-gray-400">100% Private</p>
     </div>
     <div class="p-4">
      <div class="text-2xl mb-2">
       âš¡
      </div>
      <p class="text-xs text-gray-400">Fast Processing</p>
     </div>
     <div class="p-4">
      <div class="text-2xl mb-2">
       ðŸŽ¬
      </div>
      <p class="text-xs text-gray-400">HD Quality</p>
     </div>
    </div>
   </div>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      app_title: 'Video Compressor',
      subtitle_text: 'Reduce file size without losing quality',
      upload_button_text: 'Choose Video',
      primary_color: '#6366f1',
      secondary_color: '#a855f7',
      background_color: '#0f0f23',
      text_color: '#ffffff',
      accent_color: '#10b981'
    };

    // App state
    let selectedFile = null;
    let selectedQuality = 'high';
    let compressedBlob = null;
    let originalSize = 0;

    // Quality settings (compression ratios)
    const qualitySettings = {
      high: { ratio: 0.7, bitrateFactor: 0.8 },
      medium: { ratio: 0.5, bitrateFactor: 0.5 },
      low: { ratio: 0.3, bitrateFactor: 0.3 }
    };

    // DOM Elements
    const uploadZone = document.getElementById('upload-zone');
    const videoInput = document.getElementById('video-input');
    const uploadSection = document.getElementById('upload-section');
    const settingsSection = document.getElementById('settings-section');
    const progressSection = document.getElementById('progress-section');
    const resultSection = document.getElementById('result-section');
    const qualityBtns = document.querySelectorAll('.quality-btn');
    const compressBtn = document.getElementById('compress-btn');
    const downloadBtn = document.getElementById('download-btn');
    const newVideoBtn = document.getElementById('new-video-btn');
    const removeBtn = document.getElementById('remove-btn');

    // Initialize Element SDK
    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange: async (config) => {
          document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
          document.getElementById('subtitle').textContent = config.subtitle_text || defaultConfig.subtitle_text;
          document.getElementById('upload-btn-text').textContent = config.upload_button_text || defaultConfig.upload_button_text;
        },
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => { config.background_color = value; window.elementSdk.setConfig({ background_color: value }); }
            },
            {
              get: () => config.primary_color || defaultConfig.primary_color,
              set: (value) => { config.primary_color = value; window.elementSdk.setConfig({ primary_color: value }); }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => { config.text_color = value; window.elementSdk.setConfig({ text_color: value }); }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => { config.accent_color = value; window.elementSdk.setConfig({ accent_color: value }); }
            }
          ],
          borderables: [],
          fontEditable: undefined,
          fontSizeable: undefined
        }),
        mapToEditPanelValues: (config) => new Map([
          ['app_title', config.app_title || defaultConfig.app_title],
          ['subtitle_text', config.subtitle_text || defaultConfig.subtitle_text],
          ['upload_button_text', config.upload_button_text || defaultConfig.upload_button_text]
        ])
      });
    }

    // Utility functions
    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function formatDuration(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // File handling
    function handleFile(file) {
      if (!file || !file.type.startsWith('video/')) {
        showToast('Please select a valid video file', 'error');
        return;
      }

      if (file.size > 500 * 1024 * 1024) {
        showToast('File size exceeds 500MB limit', 'error');
        return;
      }

      selectedFile = file;
      originalSize = file.size;

      document.getElementById('file-name').textContent = file.name;
      
      // Get video duration
      const video = document.createElement('video');
      video.preload = 'metadata';
      video.onloadedmetadata = () => {
        URL.revokeObjectURL(video.src);
        const duration = formatDuration(video.duration);
        document.getElementById('file-details').textContent = `${formatFileSize(file.size)} â€¢ ${duration}`;
      };
      video.src = URL.createObjectURL(file);

      updateEstimates();
      showSection('settings');
    }

    function updateEstimates() {
      const settings = qualitySettings[selectedQuality];
      const estimatedSize = originalSize * settings.ratio;
      const reduction = Math.round((1 - settings.ratio) * 100);

      document.getElementById('estimated-size').textContent = `~${formatFileSize(estimatedSize)}`;
      document.getElementById('reduction-percent').textContent = `~${reduction}%`;
    }

    function showSection(section) {
      uploadSection.classList.add('hidden');
      settingsSection.classList.add('hidden');
      progressSection.classList.add('hidden');
      resultSection.classList.add('hidden');

      switch(section) {
        case 'upload':
          uploadSection.classList.remove('hidden');
          break;
        case 'settings':
          settingsSection.classList.remove('hidden');
          break;
        case 'progress':
          progressSection.classList.remove('hidden');
          break;
        case 'result':
          resultSection.classList.remove('hidden');
          break;
      }
    }

    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      toast.className = `fixed bottom-4 left-1/2 -translate-x-1/2 px-6 py-3 rounded-xl text-white font-medium z-50 transition-all transform ${
        type === 'error' ? 'bg-red-500' : type === 'success' ? 'bg-green-500' : 'bg-indigo-500'
      }`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Compression simulation (real compression would require FFmpeg.wasm or server-side processing)
    async function compressVideo() {
      showSection('progress');
      
      const progressBar = document.getElementById('progress-bar');
      const progressPercent = document.getElementById('progress-percent');
      const progressStatus = document.getElementById('progress-status');

      const steps = [
        { progress: 20, status: 'Analyzing video...' },
        { progress: 40, status: 'Optimizing frames...' },
        { progress: 60, status: 'Compressing data...' },
        { progress: 80, status: 'Finalizing output...' },
        { progress: 100, status: 'Complete!' }
      ];

      for (const step of steps) {
        await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 400));
        progressBar.style.width = `${step.progress}%`;
        progressPercent.textContent = `${step.progress}%`;
        progressStatus.textContent = step.status;
      }

      // Simulate compressed file (in real implementation, would use FFmpeg.wasm)
      const settings = qualitySettings[selectedQuality];
      const compressedSize = Math.floor(originalSize * settings.ratio);
      
      // Create a simulated compressed blob
      compressedBlob = selectedFile.slice(0, compressedSize);

      await new Promise(resolve => setTimeout(resolve, 500));
      showResults(compressedSize);
    }

    function showResults(compressedSize) {
      const savedBytes = originalSize - compressedSize;
      const savedPercent = Math.round((savedBytes / originalSize) * 100);

      document.getElementById('original-size').textContent = formatFileSize(originalSize);
      document.getElementById('compressed-size').textContent = formatFileSize(compressedSize);
      document.getElementById('saved-size').textContent = formatFileSize(savedBytes);
      document.getElementById('saved-percent').textContent = savedPercent;

      showSection('result');
    }

    function downloadCompressed() {
      if (!compressedBlob || !selectedFile) return;

      const extension = selectedFile.name.split('.').pop();
      const baseName = selectedFile.name.replace(`.${extension}`, '');
      const newName = `${baseName}_compressed.${extension}`;

      const url = URL.createObjectURL(compressedBlob);
      const a = document.createElement('a');
      a.href = url;
      a.download = newName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showToast('Download started!', 'success');
    }

    function resetApp() {
      selectedFile = null;
      compressedBlob = null;
      originalSize = 0;
      selectedQuality = 'high';
      
      qualityBtns.forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.quality === 'high') {
          btn.classList.add('active');
        }
      });

      showSection('upload');
    }

    // Event Listeners
    uploadZone.addEventListener('click', () => videoInput.click());
    
    uploadZone.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadZone.classList.add('drag-over');
    });

    uploadZone.addEventListener('dragleave', () => {
      uploadZone.classList.remove('drag-over');
    });

    uploadZone.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadZone.classList.remove('drag-over');
      const file = e.dataTransfer.files[0];
      handleFile(file);
    });

    videoInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      handleFile(file);
    });

    qualityBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        qualityBtns.forEach(b => {
          b.classList.remove('active');
          b.classList.add('border-gray-200');
        });
        btn.classList.add('active');
        btn.classList.remove('border-gray-200');
        selectedQuality = btn.dataset.quality;
        updateEstimates();
      });
    });

    compressBtn.addEventListener('click', compressVideo);
    downloadBtn.addEventListener('click', downloadCompressed);
    newVideoBtn.addEventListener('click', resetApp);
    removeBtn.addEventListener('click', resetApp);
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9d20122510819083',t:'MTc3MTc3OTk1My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
